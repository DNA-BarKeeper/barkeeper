<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Contigs</h3>
  </div>
  <div class="panel-body">

    <div class="wideTable">
      <table id="contigs" data-source="<%= contigs_url(format: "json") %>" class="table table-striped table-hover table-bordered">
        <thead>
        <tr>
          <th>Name</th>
          <th>Assembly complete?</th>
          <td>Last updated</td>
          <td></td>
        </tr>
        </thead>

        <tbody>
        </tbody>
      </table>
    </div>

  </div>
</div>

<p>
  Assembly complete for <%= Contig.where(:assembled => true).count %> contigs.
</p>

<%= link_to 'Perform read assembly for all contigs with incomplete assembly', assemble_all_contigs_path %><br>
<!--<%= link_to 'Download .pde files for all', pde_all_contigs_path %>-->
<%= link_to 'Download .pde files for all', '#' %>

<hr>

<!--Duplicates-->
<div class="panel panel-default">

  <div class="panel-heading">
    <h3 class="panel-title">Duplicate Contigs</h3>
  </div>

  <div class="panel-body">

    <div class="wideTable">

      <table class="table table-bordered">

        <thead>
        <tr>
          <th>Name</th>
          <th>Isolate</th>
          <th>Reads</th>
          <th>Last updated</th>
          <th></th>
        </tr>
        </thead>

        <!--get list w duplicates-->
        <% a=[] %>
        <% Contig.select("name").all.each do |i| %>
            <% a << i.name %>
        <% end %>

        <% d=a.select{ |e| a.count(e) > 1 }.uniq %>

        <tbody>
        <% i=0 %>
        <% d.each do |duplicate| %>

            <% if (i % 2 == 0) %>
                <% color = "#f5f5f5" %>
            <% else %>
                <% color = "white" %>
            <% end %>

            <% Contig.includes(:isolate).where(:name => duplicate).each do |contig| %>
                <tr style="background-color: <%=color%>">
                  <td><%= link_to contig.name, edit_contig_path(contig) %></td>
                  <td>
                    <% if contig.isolate %>
                    <%=link_to contig.isolate.lab_nr, edit_isolate_path(contig)%>
                    <% end %>
                  </td>
                  <td>
                    <%=contig.primer_reads.count%>
                  </td>
                  <td> <%= contig.updated_at.in_time_zone("CET").strftime("%Y-%m-%d %H:%M:%S") %></td>
                  <td><%= link_to 'Delete', contig, method: :delete, data: { confirm: 'Are you sure?' } %></td>
                </tr>
            <% end %>
            <% i+=1 %>
        <% end %>
        </tbody>

      </table>
    </div>

    <br>

  </div>

</div>


