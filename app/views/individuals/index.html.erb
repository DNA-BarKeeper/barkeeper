<div class="panel panel-default">

  <div class="panel-heading">
    <h3 class="panel-title">Specimens / Individuals</h3>
  </div>

  <div class="panel-body">

    <div class="wideTable">
      <table id="individuals" data-source="<%= individuals_url(format: "json") %>" class="table table-striped table-hover table-bordered">

        <thead>
        <tr>
          <th>Specimen ID</th>
          <th>Species</th>
          <th>Herbarium</th>
          <th>Collector</th>
          <th>Collection Nr</th>
          <th>Last updated</th>
          <th></th>
        </tr>
        </thead>

        <tbody>
        </tbody>

      </table></div>

  </div>

</div>

<%= link_to 'New Individual', new_individual_path %>


<!-- Problems, visible only for registered users-->

<% if user_signed_in? %>

    <!-- Unassigned-->
    <%if (Individual.where(:species => nil).any?)%>
        <hr>

        <div class="panel panel-default">

          <div class="panel-heading">
            <h3 class="panel-title">Specimens where no species could be assigned:</h3>
          </div>

          <div class="panel-body">

            <div class="wideTable">

              <table class="table table-striped table-hover table-bordered">

                <thead>
                <tr>
                  <th>Specimen ID</th>
                  <th>Last updated</th>
                  <th></th>
                </tr>
                </thead>


                <tbody>

                <% Individual.where(:species => nil).each do |individual| %>

                    <tr>
                      <td><%= link_to individual.specimen_id, edit_individual_path(individual) %></td>

                      <td> <%= individual.updated_at.in_time_zone("CET").strftime("%Y-%m-%d %H:%M:%S") %></td>
                      <td><%= link_to 'Delete', individual, method: :delete, data: { confirm: 'Are you sure?' } %></td>
                    </tr>

                <% end %>
                </tbody>

              </table>
            </div>

            <br>

          </div>

        </div>

    <% end%>

    <!-- latitude/longitude Problems:-->

    <% if Individual.bad_location.any? %>

        <hr>

        <div class="panel panel-default">

          <div class="panel-heading">
            <h3 class="panel-title"><%= Individual.bad_location.count %> specimens with badly formatted or lacking latitude/longitude:</h3>
          </div>

          <div class="panel-body">

            <div class="wideTable">

              <table class="table table-striped table-hover table-bordered">

                <thead>
                <tr>
                  <th>Specimen ID</th>
                  <th>Species</th>
                  <th>Latitude</th>
                  <th>Longitude</th>
                  <th>Last updated</th>
                  <th></th>
                </tr>
                </thead>


                <tbody>

                <% Individual.bad_location.includes(:species).each do |individual| %>

                    <tr>
                      <td><%= link_to individual.specimen_id, edit_individual_path(individual) %></td>
                      <td><%= link_to individual.species.name_for_display, edit_species_path(individual.species) %></td>
                      <td><%= link_to individual.latitude, edit_individual_path(individual) %></td>
                      <td><%= link_to individual.longitude, edit_individual_path(individual) %></td>
                      <td> <%= individual.updated_at.in_time_zone("CET").strftime("%Y-%m-%d %H:%M:%S") %></td>
                      <td><%= link_to 'Delete', individual, method: :delete, data: { confirm: 'Are you sure?' } %></td>
                    </tr>

                <% end %>
                </tbody>

              </table>
            </div>

            <br>

          </div>

        </div>

    <% end %>

<% end %>